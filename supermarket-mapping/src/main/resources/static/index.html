<html>
<head>
<title>Home Page</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js"></script>
   
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

   <!-- font icon -->
  
 	                             
  <link rel="stylesheet" href="./CSS/styles.css">
     

<script>
	let name = localStorage.getItem('firstName')?localStorage.getItem('firstName'):''
			 
		if(name==''){
			  alert('login');
			  window.location = "Login.html";  
}
	function clearUser(){

		localStorage.removeItem("userRole");
		localStorage.removeItem("emailId");
		localStorage.removeItem("lastName");
		localStorage.removeItem("firstName");
		localStorage.removeItem("userId");
	}

</script>	


  
	 <!-- <link rel="stylesheet" href="./CSS/styles.css"> -->
	 
  
</head>
<body onload="product()">
	 
	
	
			 
				<header>	 
					
		<nav id="navbarScroll" class="navbar navbar-expand-lg navbar-dark bg-dark"> 
			 
			<a class="navbar-brand" href="#Home-1">
				<img src="./images/logo.jpg" alt="graphic design logo" class="logo rounded-circle" width="50px" height="40px"/>
			</a>
			
			
			<!-- Navigation menu -->
			
			 <button class="navbar-toggler btn-white" type="button" data-bs-toggle="collapse" data-bs-target="#navbarScroll" aria-controls="navbarScroll" aria-expanded="false" aria-label="Toggle navigation">
					<span class="navbar-toggler-icon"></span>
			</button>
					<!-- Navigation menu End -->
					
					 
					
				
					
			
					   
					
				
			<div class="collapse navbar-collapse" id="navbarScroll">
				<input class="form-control"  id="serach_product" type="search" placeholder="Search" aria-label="Search">
			<button class="btn btn-warning my-4 my-sm-2" style="border-radius: 50px;"  type="submit">Search</button>
				
			<ul class="navbar-nav  d-flex">
				
				<li class="nav-item">
					<a class="nav-link" href="#Home-1" aria-current="page">Home</a>
				</li>
			<li class="nav-item">
					<a class="nav-link" href="#Product-1">Product</a>
				</li>
				<div class="collapse navbar-collapse" id="navbarNavDarkDropdown">
					<ul class="navbar-nav">
						<li class="nav-item dropdown">
							<a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
								Category
							  </a>
							  <ul class="dropdown-menu dropdown-menu-dark" id="categoryName">
								 
							  </ul>
							</li>
						  </ul>
					
							</div>
			 
			<li class="nav-item">
				<a class="navbar-brand" href="#Home.html">
					Hi! <script>document.write(localStorage.getItem('firstName') + ' ' +localStorage.getItem('lastName'));</script> <img src="./images/profile-icon.jpg" alt="graphic design logo" class="logo rounded-circle mt-3" width="40px"/>
				</a>
				
			</li>
			<li class="nav-item">
				<a class="nav-link" href="Login.html" onclick="clearUser()">Logout</a>
				
			</li>
					
		</ul>
		
		
		</div>		
			 
			
			</nav>
		</header>	
 

		<!-- Button trigger modal -->
		
	<div class="productAdmin"></div>
	 

	<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog">
		  <div class="modal-content">
			<div class="modal-header">
			  <h1 class="modal-title fs-5" id="exampleModalLabel">Adding Product</h1>
			  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body">
				<div class="container">
					<div class="row d-flex justify-content-center">
					  <div class="col-12">
						<div class="card" style="border-radius: 1rem;">
						  <div class="card-body p-5">
				
					<div class="form-label">
					<label class="form-label" for="product">ProductName</label>
					<input type="text" id="product" class="form-control form-control-lg" required />
				   
					  </div>
	
					  <div class="form-label">
						<label class="form-label" for="product">Quantity</label>
						<input type="text" id="stock" class="form-control form-control-lg" required/>
					   
						  </div>
						  <div class="form-label">
							<label class="form-label" for="product">price</label>
							<input type="text" id="price" class="form-control form-control-lg" required/>
						   </div>	  
						  <div class="form-label">
							<label class="form-label" for="product">Category Name</label>
							<input type="text" id="category" class="form-control form-control-lg" required/>
						   
							  </div>	  
							  <p>Choose your product image </p>
	
							  <div class="form-label">
								<input type="file" id="myFile" name="filename" required>
								 
							  </div>
						</div>
						</div>
						</div>
						</div>
						</div>
			</div>
			<div class="modal-footer">
			  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
			  <button data-bs-toggle="modal" data-bs-target="#smallModel"  type="button" id="addprod" class="btn btn-warning">Add</button>
			</div>
		  </div>
		</div>
	  </div>


<div class="modal fade" id="smallModel" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog">
		  <div class="modal-content">
			<div class="modal-header">
			  <h1 class="modal-title fs-5" id="exampleModalLabel">Adding Product</h1>
			  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body">
				<p>Product added</p>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
					</div>
					</div>
					</div>
					</div>
					
	 
  
  <!-- Modal 
  
  <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered" role="document">
	  <div class="modal-content">
		<div class="modal-header">
		  <h5 class="modal-title" id="exampleModalLongTitle">Adding Product</h5>
		  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
			<span aria-hidden="true">&times;</span>
		</div>
		<div class="modal-body">

			<div class="container">
				<div class="row d-flex justify-content-center">
				  <div class="col-12">
					<div class="card" style="border-radius: 1rem;">
					  <div class="card-body p-5">
			
				<div class="form-label">
				<label class="form-label" for="product">ProductName</label>
				<input type="text" id="product" class="form-control form-control-lg" required />
			   
			 	 </div>

				  <div class="form-label">
					<label class="form-label" for="product">Quantity</label>
					<input type="text" id="stock" class="form-control form-control-lg" required/>
				   
					  </div>
					  <div class="form-label">
						<label class="form-label" for="product">price</label>
						<input type="text" id="price" class="form-control form-control-lg" required/>
					   </div>	  
					  <div class="form-label">
						<label class="form-label" for="product">Category Name</label>
						<input type="text" id="category" class="form-control form-control-lg" required/>
					   
						  </div>	  
						  <p>Choose your product image </p>

						  <div class="form-label">
							<input type="file" id="myFile" name="filename" required>
							 
						  </div>
					</div>
					</div>
					</div>
					</div>
					</div>
			</div>
		 
		<div class="modal-footer">
		  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
		  <button  type="button" data-dismiss="modal" class="btn btn-warning">ADD</button>
		</div>
	  </div>
	</div>
  </div>

 -->
		
		<h1 class=" text-center text-center">Products</h1>
		
  		<div class="container">
		<div class="row" id="myproduct">
			   
			   
				</div>
        </div>


		






 


<script>



 

// // add product with image product

$(document).ready(function(){
        $("#addprod").click(function(){
		var url = "http://localhost:8080/product";

		
		const formData = new FormData();
		var file = $('#myFile').prop("files")[0];

			var productname = $("#product").val();
			var stock = $("#stock").val();
			var category = $("#category").val();
			var price = $("#price").val();
			
  
      formData.append('data', JSON.stringify({
        "productName": productname,
		"stock": stock,
		"categoryId": category,
		"price":price,
		"userId": localStorage.getItem("userId")

	})),
		console.log(formData);
		formData.append('imagefile',file);
 
		$.ajax({
		type: "POST",
		url: url,
		data: formData,
		contentType: false,
    	processData: false,
		 
 		 success: function (requestProduct) {
			  
			product();
			 
				}, error: function (e) {
			  
					alert(e);
			   
				  }
			
			})
 
		})
	
	})

 
	var productData ="";

function product(){	
	$.ajax({
			dataTypa: "JSON",
			url: "http://localhost:8080/product",
			type:"GET",
			
		success: function (responseText) {
		
					
			if(localStorage.getItem('userRole') == "Admin"){

			var productAdmin = '<button type="button" class="btn btn-warning mt-3 float-end" data-bs-toggle="modal" data-bs-target="#exampleModal">Add Product</button>';


				
			}


				
			$.each(responseText, function (index, item ) {

					  localStorage.setItem('productId', responseText.productId);
                      localStorage.setItem('productName', responseText.productName);
                      localStorage.setItem('stock', responseText.stock);
                      localStorage.setItem('price', responseText.price);
					
				 

	
			 productData += ' <div class="col-lg-4 "><div class="card mb-3">' ;
				
				 
				   
			$.each(item.data, function (indeximg, itemimg) {
					
					
					productData += '<img class="img-fluid" src="data:image/png;base64,'+itemimg.imageData+'"/>';
					 
					 
				});
	productData += '<div class="card-body"><h4 class="card-title text-center">' + item.productName +'</h4><p class="card-text text-center">' +"stock: "+item.stock+'</p><p class="card-text text-center">' +"categoryname: "+item.categoryname+'</p><p class="card-text text-center">' +"price: "+item.price+'</p>';
						
						if(localStorage.getItem('userRole') == "Admin"){
						
						productData +='<a onclick="editProduct('+item.productId+')" class="btn btn-warning btn-sm float-left card-link"><b>Edit</b></a> <a onclick="deleteProduct('+item.productId+')" class="btn btn-warning btn-sm float-right card-link "><b>Delete</b></a>';
						
						}
						else{
							productData +=' <button class="btn btn-outline-warning" type="button" id="Order">Order</button>';
						}
						productData +='</div></div></div> '; 
				
				});
				$("#myproduct").empty();
				$("#myproduct").append(productData);
				$(".productAdmin").append(productAdmin);	
			}
			
		});
}

$(document).ready(function(){
    $('#serach_product').on('keyup', function() {
         
		$.ajax({
			dataType: "JSON",
			url: "http://localhost:8080/product/"+$(this).val(),
			type: "GET",
			
			success: function (response){

			
			}

		})
    });
});





 
	function editProduct(productId){

		var url = "http://localhost:8080/product/"+productId;
		
		$.ajax({
			dataType: "JSON",
			url: url,
			type: "GET",
 
			success: function (response){

				$("#product").val(response.productName);
				$("#stock").val(response.stockDetails);
				$("#category").val(response.categoryname);

			$.ajax({
			dataType: "JSON",
			url: url,
			type: "PUT",
			
 
			success: function (response){

			}
		})


				}
		})

		 
	
		$.ajax({
			dataType: "JSON",
			url: url,
			type: "PUT",
			async:false,
			crossDomain:true,
			
		success: function (responseText, status) {

		}
	})
	


}


$(document).ready(function(){
	$("#deletesubmit").click(function(){

	var url = "http://localhost:8080/product";
		var deletedata = null;
	$.ajax({
			dataType: "JSON",
			url: url,
			type: "DELETE",
			async:false,
			crossDomain:true,
			
		success: function (responseText, status) {

		}
	})
	
})
})
 




var categorytype = "";
$(document).ready (function () {
		var url = "http://localhost:8080/category/ordercategory";
	$.ajax({
			dataTypa: "JSON",
			url: url,
			type: "GET",
			
		success: function (response) {
			
			$.each(response, function (index, item) {
					console.log(item.categoryId);
	categorytype += "<li onclick='categoryProduct(this.value)' value='"+item.categoryId+"' class='dropdown-item'>"+item.categoryName+"</li>";
				 

			})

			$("#categoryName").append(categorytype);

		}

	})

})

function categoryProduct(categoryId){

	var uri = "http://localhost:8080/product/categoryId?id="+categoryId;
	$.ajax({
			dataTypa: "JSON",
			url: uri,
			type: "GET",
			success: function (response) {
				
				$.each(response, function (index, item) {

				productData += ' <div class="col-lg-4 "><div class="card mb-3">' ;
				  
				$.each(item.data, function (indeximg, itemimg) {
						
						
		productData += '<img class="img-fluid" src="data:image/png;base64,'+itemimg.imageData+'"/>';
						 
						 
					});
		productData += '<div class="card-body"><h4 class="card-title text-center">' + item.productName +'</h4><p class="card-text text-center">' +"stock: "+item.stock+'</p><p class="card-text text-center">' +"categoryname: "+item.categoryname+'</p><p class="card-text text-center">' +"price: "+item.price+'</p>';
							
							if(localStorage.getItem('userRole') == "Admin"){
							
			productData +='<a onclick="editProduct('+item.productId+')" class="btn btn-warning btn-sm float-left card-link"><b>Edit</b></a> <a onclick="deleteProduct('+item.productId+')" class="btn btn-warning btn-sm float-right card-link "><b>Delete</b></a>';
							
							}
							else{
								productData +=' <button class="btn btn-outline-warning" type="button" id="Order">Order</button>';
							}
							productData +='</div></div></div> '; 
					
					});
					
					$("#myproduct").empty();
					$("#myproduct").append(productData);
					
 
				
			}

		})
		 
}






// $(document).ready (function () {
// 		var url = "http://localhost:8080/items";
// 	$.ajax({
// 			dataTypa: "JSON",
// 			url: url,
// 			type: "GET",
			
// 		success: function (requestProduct) {
					
// 		}

// 	})

// })




</script>
 
</body>
</html>